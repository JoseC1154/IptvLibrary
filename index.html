<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#0b1020" />
    <meta name="description" content="PWA IPTV Link Manager" />
    <link rel="manifest" href="manifest.webmanifest" />
    <link rel="icon" href="assets/icons/icon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="assets/icons/icon.svg" />
    <link rel="stylesheet" href="styles.css" />
    <title>IPTV Library</title>
  </head>
  <body>
    <div class="app-shell">
      <header class="topbar glass">
        <div class="brand">
          <div class="brand-icon" aria-hidden="true">ðŸ“º</div>
          <div>
            <h1>IPTV Library</h1>
            <p>Apple TVâ€“style channel manager</p>
          </div>
        </div>

        <div class="topbar-actions">
          <button id="addChannelBtn" class="btn primary">Add Channel</button>
          <button id="addGroupBtn" class="btn">Add Group</button>
          <button id="addPlaylistBtn" class="btn">Add M3U Stream Playlist</button>
          <button id="exportBtn" class="btn">Export</button>
          <label class="btn file-btn" for="importInput">Import</label>
          <input id="importInput" type="file" accept="application/json" hidden />
        </div>
      </header>

      <main class="layout">
        <aside class="sidebar glass">
          <div class="sidebar-head">
            <h2>Channel Groups</h2>
          </div>
          <nav id="groupList" class="group-list" aria-label="Channel groups"></nav>
        </aside>

        <section class="content">
          <div class="content-head">
            <h2 id="currentGroupTitle">All Channels</h2>
            <span id="channelCount" class="count-pill">0 channels</span>
          </div>

          <div id="channelGrid" class="channel-grid" aria-live="polite"></div>
          <p id="emptyState" class="empty-state hidden">No channels yet. Add one to get started.</p>
        </section>
      </main>

      <section id="nowPlayingBar" class="now-playing glass hidden" aria-live="polite">
        <div class="now-playing-info">
          <h3 id="nowPlayingTitle">Now Playing</h3>
          <p id="nowPlayingSubtitle">No channel selected</p>
        </div>
        <div class="now-playing-actions">
          <button id="nowPlayingOpenBtn" class="btn primary" type="button">Play</button>
          <button id="nowPlayingCastBtn" class="btn hidden" type="button">Cast</button>
        </div>
      </section>
    </div>

    <dialog id="groupDialog" class="dialog glass">
      <form id="groupForm" method="dialog" class="form-stack">
        <h3 id="groupDialogTitle">Add Group</h3>
        <input type="hidden" id="groupId" />

        <label>
          Group Name
          <input id="groupName" type="text" required maxlength="60" placeholder="Kids Channel" />
        </label>

        <div class="dialog-actions">
          <button type="button" id="deleteGroupBtn" class="btn danger hidden">Delete</button>
          <button type="button" class="btn" data-close="groupDialog">Cancel</button>
          <button type="submit" class="btn primary">Save</button>
        </div>
      </form>
    </dialog>

    <dialog id="channelDialog" class="dialog glass">
      <form id="channelForm" method="dialog" class="form-stack">
        <h3 id="channelDialogTitle">Add Channel</h3>
        <input type="hidden" id="channelId" />

        <label>
          Channel Name
          <input id="channelName" type="text" required maxlength="80" placeholder="Cartoon Network" />
        </label>

        <label>
          Group
          <select id="channelGroup" required></select>
        </label>

        <label>
          IPTV Link URL
          <input id="channelUrl" type="url" required placeholder="https://example.com/live.m3u8" />
        </label>

        <label>
          Custom Photo URL
          <input id="channelImage" type="url" placeholder="https://images.example.com/poster.jpg" />
          <p id="channelImageFeedback" class="field-feedback hidden" role="status" aria-live="polite"></p>
          <img id="channelImagePreview" class="image-preview hidden" alt="Channel image preview" loading="lazy" />
        </label>

        <div class="dialog-actions">
          <button type="button" id="deleteChannelBtn" class="btn danger hidden">Delete</button>
          <button type="button" class="btn" data-close="channelDialog">Cancel</button>
          <button type="submit" class="btn primary">Save</button>
        </div>
      </form>
    </dialog>

    <dialog id="playerDialog" class="dialog player-dialog glass">
      <div class="player-shell">
        <div class="player-head">
          <div>
            <h3 id="playerTitle">Channel Player</h3>
            <p id="playerSubtitle">Select a channel to start playback.</p>
          </div>
        </div>

        <div id="playerVideoHost" class="player-video-host">
          <video
            id="playerVideo"
            class="player-video"
            controls
            playsinline
            webkit-playsinline="true"
            x-webkit-airplay="allow"
          ></video>
        </div>

        <p id="playerStatus" class="field-feedback hidden" role="status" aria-live="polite"></p>

        <div class="dialog-actions">
          <button id="playerCastBtn" type="button" class="btn hidden">Cast</button>
          <button id="playerSystemBtn" type="button" class="btn">System Player</button>
          <a id="playerOpenExternal" class="btn" target="_blank" rel="noopener noreferrer">Open External</a>
          <button id="playerStopBtn" type="button" class="btn danger">Stop</button>
          <button id="playerCloseBtn" type="button" class="btn">Minimize</button>
        </div>
      </div>
    </dialog>

    <dialog id="m3uDialog" class="dialog m3u-dialog glass">
      <div class="player-shell">
        <div class="player-head">
          <div>
            <h3>M3U Playlist</h3>
            <p id="m3uSummary">No playlist loaded.</p>
          </div>
        </div>

        <div class="m3u-search-wrap">
          <input id="m3uSearchInput" type="search" placeholder="Search channels, groups, or URL..." />
        </div>

        <form id="networkStreamForm" class="network-stream-form glass">
          <h4>Add Network Stream URL</h4>
          <div class="network-import-row">
            <label class="btn file-btn" for="m3uImportInput">Import M3U File</label>
            <input id="m3uImportInput" type="file" accept=".m3u,.m3u8,audio/x-mpegurl,application/vnd.apple.mpegurl,text/plain" hidden />
          </div>
          <input id="networkStreamUrl" type="url" placeholder="https://example.com/live.m3u8" required />
          <div class="network-stream-grid">
            <input id="networkStreamTitle" type="text" maxlength="80" placeholder="Channel title (optional)" />
            <input id="networkStreamGroup" type="text" maxlength="60" placeholder="Group (optional, default: Imported)" />
          </div>
          <input id="networkStreamLogo" type="url" placeholder="Logo URL (optional)" />
          <div class="dialog-actions">
            <button id="networkAddBtn" type="submit" class="btn primary">Open URL</button>
          </div>
        </form>

        <div id="m3uList" class="m3u-list"></div>
        <p id="m3uEmpty" class="field-feedback">Import an M3U/M3U8 file to view channels.</p>

        <div class="dialog-actions">
          <button id="m3uAddAllBtn" type="button" class="btn primary">Add All</button>
          <button id="m3uCloseBtn" type="button" class="btn" data-close="m3uDialog">Close</button>
        </div>
      </div>
    </dialog>

    <section id="miniPlayer" class="mini-player glass hidden" aria-live="polite">
      <div id="miniPlayerDragHandle" class="mini-player-drag" role="button" aria-label="Drag mini player">Drag</div>
      <div id="miniPlayerVideoHost" class="mini-player-video-host"></div>
      <div class="mini-player-actions">
        <button id="miniPlayerRestoreBtn" type="button" class="btn tiny">Restore</button>
        <button id="miniPlayerStopBtn" type="button" class="btn tiny danger">Stop</button>
      </div>
    </section>

    <template id="channelCardTemplate">
      <article class="channel-card glass">
        <button class="card-edit btn tiny" type="button">Edit</button>
        <a class="card-link" target="_blank" rel="noopener noreferrer">
          <img class="card-image" alt="" loading="lazy" />
          <div class="card-info">
            <h4 class="card-title"></h4>
            <p class="card-group"></p>
          </div>
        </a>
      </article>
    </template>

    <template id="m3uItemTemplate">
      <article class="m3u-item glass">
        <div class="m3u-item-main">
          <img class="m3u-item-image" alt="" loading="lazy" />
          <div>
            <h4 class="m3u-item-title"></h4>
            <p class="m3u-item-subtitle"></p>
          </div>
        </div>
        <div class="m3u-item-actions">
          <button class="btn tiny m3u-play-btn" type="button">Preview</button>
          <select class="m3u-group-select" aria-label="Select target group"></select>
          <button class="btn tiny primary m3u-add-btn" type="button">Add</button>
        </div>
      </article>
    </template>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.18/dist/hls.min.js" defer></script>
    <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1" async defer></script>
    <script src="app.js" type="module"></script>
  </body>
</html>
